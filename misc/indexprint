#!/bin/sh 
# $Id: indexprint,v 1.5 2002/08/11 18:10:29 braun Exp $
#
# $Log: indexprint,v $
# Revision 1.5  2002/08/11 18:10:29  braun
# *** empty log message ***
#
# Revision 1.4  1999/07/05 18:54:13  braun
# removed the full path in the references and links.
#
# Revision 1.3  1999/04/10 19:27:08  braun
# remocved a unnecessary line.
#
# Revision 1.2  1999/04/10 19:24:19  braun
# added ALT text to the image.
#
# Revision 1.1  1999/04/10 17:02:21  braun
# Initial revision
#
#
#set -x
#
GEOMETRY="120x120"
EXTENSION="jpg"
SUFFIX="_"
NEW_EXTENSION="${SUFFIX}.${EXTENSION}"
TN_FOLDER=".TN"
#
IDENT=`basename $0`
DIRECTORY=`pwd`
TITLE="Index of ${DIRECTORY}"
#-------------------------------
info() {
   echo "${IDENT} [info] $@" >&2
}
error() {
   echo "${IDENT} [errror] $@" >&2
}
warning() {
   echo "${IDENT} [warning] $@" >&2
}
#--------------------------------------------
# MAIN
#-----
cat << __HEADER__
<HTML>
<HEAD>
<TITLE>$TITLE</TITLE>
</HEAD>
<BODY BGCOLOR="FFFFFF">
<H1>$TITLE</H1>
<HR>
__HEADER__
#--------------------------------------------------
# Create Thumbnail Folder
#---
mkdir -p ./${TN_FOLDER}
#--------------------------------------------------
for IMAGE in $*
do
	# image name without extension
	IMAGENAME=`basename ${IMAGE} .${EXTENSION}`
	# cut the suffix from the name
	TESTNAME=`basename ${IMAGENAME} .${SUFFIX}`
	THUMBNAILNAME=${TN_FOLDER}/${IMAGENAME}.${NEW_EXTENSION}
	if [ ${IMAGENAME} = ${TESTNAME} ]; then
    # if thumbnail exists and is newer than image
		if [ -f ${THUMBNAILNAME} -a \
                ${THUMBNAILNAME} -nt ${IMAGE} ]; then
			info "${IMAGE} already thumbnailed - no conversion."
		else
			info "converting ${IMAGE} to ${THUMBNAILNAME} ..."
			/usr/bin/convert -geometry ${GEOMETRY} ${IMAGE} ${THUMBNAILNAME} 
			info "... ready."
		fi
		info "${IMAGE} registered as link."
		echo "<A HREF=\"${IMAGE}\">"
		echo "<IMG SRC=\"${THUMBNAILNAME}\" "
 		echo "</A>"
	else
		info "${IMAGE} is a thumbnail and will not be processed."
	fi
done
#---------------------------------------------------
cat << __FOOTER__
<HR>
<ADDRESS>Page generated by ${IDENT}, $Revision: 1.5 $ at `date` </ADDRESS>
</BODY></HTML>
__FOOTER__
#---------------------------------------------------
exit 0
# EOF
